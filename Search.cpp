////////////////////////////////////////////////////////////////
# include "Search.h"
////////////////////////////////////////////////////////////////
// : Node::getmoves
// > Node::make_move
// + Node::check
// < Node::undo_move
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
u64 Search::perft_( int depth ){
    if( depth == 0 ) return 1;
    auto m = cache.getvalue( node->gethash(), depth );
    if( m > 0 ) return m;
    auto moves = node->getmoves();
    u64 n = 0;
    for( const auto& mov: moves ){
        node->make_move( mov );
        if( node->check() == false ){
            n += perft_( depth - 1 );
        }
        node->undo_move( mov );
    }
    cache.setvalue( n, node->gethash(), depth );
    return n;
}
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
u64 Search::perft( int depth ){
    bm.start();
    auto n = perft_( depth );
    bm.stop();
    bm.log();
    return n;
}
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
